<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Demo: api.DOMMatrixReadOnly.transformPoint</title>
</head>
<body>
  Check dev tools console for status
  <script>
    (function () {
      // **** Custom support functions for WPT tests ****
      function assert_equals(value, expected, message) {
        if (value !== expected) {
          throw new Error(`assert_equals failed: ${message}`);
        }
      }
      function test(cb, name) {
        try {
          cb();
          console.log('✔ Test successful:', name);
        } catch (err) {
          console.error('❌ Test failed:', name, err);
        }
      }

      // **** From WPT ****

      // From https://github.com/web-platform-tests/wpt/blob/7b0ebaccc62b566a1965396e5be7bb2bc06f841f/css/geometry/DOMMatrix-003.html#L89-L95
      function getMatrixTransform(matrix, point) {
        var x = point.x * matrix.m11 + point.y * matrix.m21 + point.z * matrix.m31 + point.w * matrix.m41;
        var y = point.x * matrix.m12 + point.y * matrix.m22 + point.z * matrix.m32 + point.w * matrix.m42;
        var w = point.x * matrix.m13 + point.y * matrix.m23 + point.z * matrix.m33 + point.w * matrix.m43;
        var z = point.x * matrix.m14 + point.y * matrix.m24 + point.z * matrix.m34 + point.w * matrix.m44;
        return new DOMPoint(x, y, w, z)
      }

      // From https://github.com/web-platform-tests/wpt/blob/7b0ebaccc62b566a1965396e5be7bb2bc06f841f/css/geometry/DOMMatrix-003.html#L309-L314
      function checkDOMPoint(p, exp) {
        assert_equals(p.x, exp.x, "x is not matched");
        assert_equals(p.y, exp.y, "y is not matched");
        assert_equals(p.z, exp.z, "z is not matched");
        assert_equals(p.w, exp.w, "w is not matched");
      }

      // From https://github.com/web-platform-tests/wpt/blob/7b0ebaccc62b566a1965396e5be7bb2bc06f841f/css/geometry/DOMMatrix-003.html#L273-L279
      test(function() {
        var point = new DOMPointReadOnly(1, 2, 3, 4);
        var matrix = new DOMMatrix([1, 2, 3, 4, 5, 6]);
        var result = matrix.transformPoint(point);
        var expected = getMatrixTransform(matrix, point);
        checkDOMPoint(result, expected);
      },"test transformPoint() - 2d matrix");

      // From https://github.com/web-platform-tests/wpt/blob/7b0ebaccc62b566a1965396e5be7bb2bc06f841f/css/geometry/DOMMatrix-003.html#L281-L287
      test(function() {
        var point = new DOMPointReadOnly(1, 2, 3, 4);
        var matrix = new DOMMatrix([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]);
        var result = matrix.transformPoint(point);
        var expected = getMatrixTransform(matrix, point);
        checkDOMPoint(result, expected);
      },"test transformPoint() - 3d matrix");
    }());
  </script>
</body>
</html>